<!DOCTYPE html>
<html lang="en" xmlns:overflow="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>测试页</title>
    <script src="./js/JQuery.min.js"></script>
    <script type="text/javascript" src="/js/L2Dwidget.0.min.js"></script>
    <script type="text/javascript" src="/js/L2Dwidget.min.js"></script>
    <script type="text/javascript" src="/js/test.js"></script>
    <style type="text/css">
        p1 {
            display: inline-block;
            width: 11%;
            background-color: #FF3C00CB;
            color: white;
            font-size: 20px;
            text-indent: 12px;
        }
        .functionBlock {
            background-color: whitesmoke;
            margin-top: 20px;
        }
        #regist {
            display: inline-block;
            width: 30%;
            align-content: center;
            margin-left: 0px;
            margin-right: 30px;
        }
        #login {
            display: inline-block;
            width: 30%;
            align-content: center;
            margin-left: 20px;
            margin-right: 0px;
        }
        #logout {
            display: inline-block;
            width: 30%;
            align-content: center;
            margin-left: 48px;
            margin-right: 0px;
        }
        p0 {
            display: inline-block;
            width: 37%;
            background-color: #FF3C00CB;
            color: white;
            font-size: 20px;
            text-indent: 12px;
        }
        p2{
            display: inline-block;
            width: 21%;
            background-color: #FF3C00CB;
            color: white;
            font-size: 20px;
            text-indent: 12px;
        }
        p3{
            display: inline-block;
            width: 28%;
            background-color: #FF3C00CB;
            color: white;
            font-size: 20px;
            text-indent: 12px;
        }
        p4{
            display: inline-block;
            width: 20%;
            background-color: #FF3C00CB;
            color: white;
            font-size: 20px;
            text-indent: 12px;
        }
        .top3in {
            margin-left: 14%;
            margin-top: 4%;
            margin-bottom: 5%;
        }
        .top3btn {
            width: 80%;
            margin-left: 5px;
            margin-top: 10px;
            height: 30px;
        }
        #infoCollect {
            width: 58%;
            margin-right: 0px;
            display: inline-block;
        }
        .top2in {
            margin-top: 20px;
            margin-left: 80px;
            margin-bottom: 30px;
        }
        #grpDiv {
            width: 40%;
            margin-left: 16px;
            display: inline-block;
        }
        #grpDivIn {
            height: 220px;
            margin-left: 60px;
            margin-top: 52px;
            margin-bottom: 30px;
        }
        #comAddIn {
            margin-left: 20%;
            margin-top: 10px;
        }
        #comAddInExt {
            width: 80%;
        }
    </style>
</head>


<body>
<!--头部信息-->
<div id="page1">
    <iframe align="center" width="100%" height="60" src="./head.html" frameborder="no" border="0"
            marginwidth="0" marginheight="0" scrolling="no"></iframe>
</div>

<!--页面内容-->
<div class="shopinfor">
    <div class="functionBlock" id="regist">
        <!--商家注册-->
        <form action="/business/regist" method="POST">
            <p0>商家注册 ></p0>
            <br>
            <div class="top3in">
                手机号码：<input type="text" name="phone_number"><br/>
                商家密码：<input type="password" name="business_passwd"><br/>
                <input type="submit" value="注册" class="top3btn">
            </div>
        </form>
    </div>

    <div class="functionBlock" id="login">
    <!--商家登录-->
    <form action="/business/login" method="POST">
        <p0>商家登录 ></p0>
        <br>
        <div class="top3in">
        手机号码：<input type="text" name="phone_number"><br/>
        商家密码：<input type="password" name="business_passwd"><br/>
        <input type="submit" value="登录" class="top3btn">
        </div>
    </form>
    </div>

    <div class="functionBlock" id="logout">
    <!--退出当前账号-->
    <form action="/business/logout" method="POST">
        <p0>退出账号 ></p0><br/>
        <div class="top3in">
        <div style="display: inline-block; height: 60px">
            <h4 style="margin-left: 10px">单击退出按钮以退出当前账号</h4>
        </div><br/>
        <input type="submit" value="退出" class="top3btn">
        </div>
    </form>
    </div>

    <div class="functionBlock" id="infoCollect">
    <p2>完善信息 ></p2>
        <div class="top2in">
    <form enctype='multipart/form-data' action="/business/mece/uploadLogo" method="POST"
          target="EmptyIFrame">
        商家logo：
        <input type="file" name="business_logo">
        <input type="submit" value="上传">
    </form>
    <form enctype='multipart/form-data' action="/business/mece/uploadDrop" method="POST"
          target="EmptyIFrame">
        主页背景：
        <input type="file" name="business_backdrop">
        <input type="submit" value="上传">
    </form>
    <form action="/business/mece/updateBusInfo" method="POST">
        店铺名称：<input type="text" name="shop_name">
        月销售量：<input type="text" name="monthly_sales"><br>
        起送价格：<input type="text" name="start_delivery_price">
        配送费用：<input type="text" name="delivery_price"><br>
        优惠信息：<input type="text" name="discount_info">
        商家公告：<input type="text" name="business_notice"><br>
        &nbsp;东&nbsp;&nbsp;&nbsp;&nbsp;经&nbsp;：<input type="text" name="business_longitude">
        &nbsp;北&nbsp;&nbsp;&nbsp;&nbsp;纬&nbsp;：<input type="text" name="business_latitude"><br/>
        <a href="http://api.map.baidu.com/lbsapi/getpoint/" target="_blank" style="margin-left: 8px; text-decoration: none; font-size: 18px;">查询→坐标拾取系统</a>&nbsp;
        <input type="submit" value="更新信息" style="width: 45%; margin-top: 20px; margin-left: 35px; height: 30px;">
    </form>
        </div>
    </div>

    <div class="functionBlock" id="grpDiv">
        <p3>拼团设置 ></p3>
        <div id="grpDivIn">
        <form action="/business/mece/setGrpInfo" method="post">
            商品编号：<input type="text" name="com_id" style="width: 58%;"><br>
            拼团数量：<input type="text" name="grpNum" style="width: 58%;"><br>
            免单人数(每团):<input type="text" name="freeNum" style="width: 50%;"><br/>
            开始时间：<input type="datetime-local" name="start_time">
            <br>
            结束时间：<input type="datetime-local" name="end_time">
            <br>
            <input type="submit" value="设置拼团" style="width: 60%; margin-top: 20px; margin-left: 35px; height: 30px;">
        </form>
        </div>
    </div>

    <div class="functionBlock" id="comAddInExt">
    <p4>商品上架 ></p4>

        <div id="comAddIn">
    <form enctype='multipart/form-data' action="/business/mece/uploadComImg" method="POST"
          target="EmptyIFrame">
        商品图片：
        <input type="file" name="com_img">
        <input type="submit" value="点击上传">（必须）
    </form>
    <form enctype='multipart/form-data' action="/business/mece/uploadDtlImg1" method="POST"
          target="EmptyIFrame">
        详情图一：
        <input type="file" name="dtl_img1">
        <input type="submit" value="点击上传">（必须）
    </form>
    <form enctype='multipart/form-data' action="/business/mece/uploadDtlImg2" method="POST"
          target="EmptyIFrame">
        详情图二：
        <input type="file" name="dtl_img2">
        <input type="submit" value="点击上传">（可选）
    </form>
    <form enctype='multipart/form-data' action="/business/mece/uploadDtlImg3" method="POST"
          target="EmptyIFrame">
        详情图三：
        <input type="file" name="dtl_img3">
        <input type="submit" value="点击上传">（可选）
    </form>
    <form enctype='multipart/form-data' action="/business/mece/uploadDtlImg4" method="POST"
          target="EmptyIFrame">
        详情图四：
        <input type="file" name="dtl_img4">
        <input type="submit" value="点击上传">（可选）
    </form>
    <form enctype='multipart/form-data' action="/business/mece/uploadDtlImg5" method="POST"
          target="EmptyIFrame">
        详情图五：
        <input type="file" name="dtl_img5">
        <input type="submit" value="点击上传">（可选）
    </form>
    <form action="/business/mece/addCommodity">
        商品名称：<input type="text" name="com_name">
        商品描述：<input type="text" name="com_des"><br>
        商品价格：<input type="text" name="com_price">
        折扣价格：<input type="text" name="discount_price"><br>
        商品类别：<input type="text" name="com_type">
        成团人数：<input type="text" name="com_pchs_num"><br>
        <input type="submit" value="点击添加" style="margin-bottom: 30px; width: 35%; height: 28px; margin-top: 20px; margin-left: 15%">
    </form>
        </div>
    </div>

    <div class="functionBlock">
    <p1>商品列表 ></p1>&nbsp;&nbsp;
    <button type="button" class="chaxun" style="margin-bottom: 10px;">刷新</button>
    <div style="text-align: center;overflow: hidden;">
        <table id="table1" border="1" style="width: 100%; border-color: ivory;" cellspacing="0px" cellpadding="1px">

        </table>
    </div>
    </div>

    <div class="functionBlock">
    <p1>拼团列表 ></p1>&nbsp;&nbsp;
    <button type="button" class="getGrpInfo" id="pintuan">刷新</button>
    <div style="text-align: center; overflow: hidden;">
<!--        接口：/business/mece/getGrpInfo-->
        <table id="table2" border="1" style="width: 100%; border-color: ivory; margin-top: 10px;" cellspacing="0px" cellpadding="1px">

        </table>
    </div>

    <script>
        L2Dwidget.init({
            "display": {
                "superSample": 2,
                "width": 200,
                "height": 400,
                "position": "right",
                "hOffset": 0,
                "vOffset": 0
            }
        });
    </script>
    </div>

    <div class="functionBlock">
        <p1>订单列表 ></p1>&nbsp;&nbsp;
        <button type="button" class="getGrpInfo">刷新</button>
        <div style="text-align: center; overflow: hidden;">
            <table border="1" style="width: 100%; border-color: ivory; margin-top: 10px;" cellspacing="0px" cellpadding="1px">
<!--                订单表格！！！-->
            </table>
        </div>
    </div>




</div>

<iframe name="EmptyIFrame" frameborder="0" width="0" height="0"></iframe>

<br><br><br><br>
<!--底部信息-->
<div id="page2">
    <iframe align="center" width="100%" height="170" src="./bottom.html" frameborder="no" border="0"
            marginwidth="0" marginheight="0" scrolling="no"></iframe>
</div>


<script type="text/javascript">
    $(function () {
        var arr = []

        // 渲染上查询商品

        function xuanran() {
            // var div = $("<div>外部添加的元素</div>")
            // $(".test").after(div)//放到test的后面
            // $(".test").before(div)//放到test的前面
            for (var i in arr) {
                var tr = $('<tr class="forTr" data-arrIndex="' + arr[i]
                        .com_id + '" ><td class="com_name">' + arr[i]
                        .com_id +
                    '</td><td class="com_id">' + arr[i]
                        .com_name + '</td><td class="com_price">' + arr[i].com_price +
                    '</td><td class="discount_price">' + arr[i].discount_price +
                    '</td><td class="com_des">' + arr[i].com_des + '</td><td class="comment_pct">' + arr[
                        i].comment_pct + '</td><td class="com_monthly_sales">' + arr[i]
                        .com_monthly_sales + '</td><td class="grp_pchs_num">' + arr[i].grp_pchs_num +
                    '</td><td class="delete1"><button type="button" style="height: 100%; width: 100%;">下架</button></td></tr>')

                $(".thHead").after(tr)
            }

            // 删除按钮函数
            $(".delete1").click(function (e) {
                console.log(e)
                var arrIndex = $(e.target).parent().parent().attr('data-arrindex')

                var told =confirm("您确认下架吗");
                if (told) {
                    $(e.target).parent().parent().hide(300)
                    $.ajax({
                        type: "POST",
                        url: "/business/mece/com_delete",
                        async: true,
                        dataType: "json",
                        data: {
                            com_id:arrIndex
                        },
                        //  默认情况下，标准的跨域请求是不会发送cookie的
                        success: function (res) {
                            if(res == 1){
                                alert("下架成功")
                            }else {
                                alert("下架失败，该商品存在未完成订单")
                            }
                            chaxun()
                        },
                    });
                };
            })
        }
        groupLookUp()
        function groupLookUp(){
            console.log(11111)
            $("#table2").empty()
            let thHead = $("<tr style=\"background-color: dodgerblue; color: azure; height: 35px;\" class=\"thHead2\">\n" +
                "                <th>拼团编号</th>\n" +
                "                <th>商品编号</th>\n" +
                "                <th>商品名称</th>\n" +
                "                <th>开始时间</th>\n" +
                "                <th>结束时间</th>\n" +
                "                <th>当前人数</th>\n" +
                "                <th>成团人数</th>\n" +
                "                <th>拼团状态</th>\n" +
                "                <th>操作</th>\n" +
                "            </tr>")

            $("#table2").append(thHead)

            $.ajax({
                type: "POST",
                url: "/business/mece/getGrpInfo",
                async: true,
                dataType: "json",
                contentType: "application/json; charset=UTF-8",
                //  默认情况下，标准的跨域请求是不会发送cookie的
                xhrFields: {
                    withCredentials: true
                },
                success: function (res) {
                    let list = res
                    for (var i in list) {
                        let tr = $('<tr class="forTr" data-arrIndex="' + list[i]
                                .group_id + '" ><td class="group_id">' + list[i]
                                .group_id +
                            '</td><td class="com_id">' + list[i]
                                .com_id + '</td><td class="com_name">' + list[i].com_name +
                            '</td><td class="start_time">' + list[i].start_time +
                            '</td><td class="end_time">' + list[i].end_time + '</td><td class="presentNum">' + list[
                                i].presentNum + '</td><td class="grp_pchs_num">' + list[i]
                                .grp_pchs_num + '</td><td class="status">' + list[i].status +
                            '</td><td class="delete2"><button type="button" style="height: 100%; width: 100%;"> 删除</button></td></tr>')

                        $(".thHead2").after(tr)


                    }
                    tuituan()
                },
            });

        }

        function tuituan(){
            $(".delete2").click(function (e) {
                let group_id = $(e.target).parent().parent().attr('data-arrindex')
                console.log(group_id)
                let told =confirm("您确认下架吗");
                if (told) {
                    $(e.target).parent().parent().hide(300)
                    $.ajax({
                        type: "POST",
                        url: "/business/mece/grpDel",
                        async: true,
                        dataType: "json",
                        data: {
                            group_id:group_id
                        },
                        //  默认情况下，标准的跨域请求是不会发送cookie的
                        success: function (res) {
                            if(res == 1){
                                alert("删除成功")
                            }else {
                                alert("删除失败，该商品存在未完成订单")
                            }
                            groupLookUp()

                        },
                    });
                };
            })
        }
        $("#pintuan").click(function(){
            groupLookUp()
        });


        // $("td").attr("contenteditable","true")
        //
        //
        //
        // // 更新在线商品
        // $(".baocun").click(function() {
        //     arrDelete.sort();
        //     for (var i = arrDelete.length - 1; i >= 0; i--) {
        //         arr.splice(arrDelete[i], 1);
        //     }
        //
        //     $.ajax({
        //     	type: "POST",
        //     	url: "/business/mece/comLookup",
        //     	async: true,
        //     	dataType: "json",
        //     	contentType: "application/json; charset=UTF-8",
        //     	//  默认情况下，标准的跨域请求是不会发送cookie的
        //     	xhrFields: {
        //     		withCredentials: true
        //     	},
        //     	success: function(result) {
        //     		console.log(result[0]);
        //     	},
        //     });
        //
        //     console.log(arr);
        // })

        // 查询商品接口、
        function chaxun(){
            //请求参数对象
            // var params = {};
            // params.userName = "pan_junbiao的博客";
            // params.password = "123456";
            //执行Ajax请求
            $("#table1").empty()
            let thHead = $("<tr style=\"background-color: dodgerblue; height: 35px; color: azure\" class=\"thHead\">\n" +
                "                <th>商品编号</th>\n" +
                "                <th>商品名称</th>\n" +
                "                <th>商品价格</th>\n" +
                "                <th>折扣价</th>\n" +
                "                <th>商品描述</th>\n" +
                "                <th>好评率</th>\n" +
                "                <th>月售</th>\n" +
                "                <th>成团人数</th>\n" +
                "                <th>操作</th>\n" +
                "            </tr>")
            $("#table1").append(thHead)

            $.ajax({
                type: "POST",
                url: "/business/mece/comLookup",
                async: true,
                dataType: "json",
                contentType: "application/json; charset=UTF-8",
                //  默认情况下，标准的跨域请求是不会发送cookie的
                xhrFields: {
                    withCredentials: true
                },
                success: function (result) {
                    arr = result
                    xuanran()
                },
            });

        }
        $(".chaxun").click(chaxun());
    })
</script>
<style>
    .shopinfor {
        width: 1100px;
        margin: 0px auto;
    }

    input {
        margin: 5px 0px;
    }
</style>
</div>
</body>
</html>
